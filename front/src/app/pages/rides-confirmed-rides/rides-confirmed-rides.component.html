<div class="header bg-gradient-skyblue p-3 pb-7 pt-7  ">
  <div class="container-fluid">
    <div class="header">
      <h1>Confirmed Rides</h1>
      <!-- Card stats -->

    </div>
  </div>
</div>
<ng-template #content let-modal>
  <div class="bg-aliceblue modal-div ">

    <div class="modal-header">
      <h4>Service Type</h4>
      <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')"><span
          aria-hidden="true">&times;</span></button>
    </div>

    <div class="modal-body text-center">

      <label for="status">Filter by status:</label>
      <select id="status">
        <option value="">All</option>
        <option value="accepted">Accepted</option>
        <option value="arrived">Arrived</option>
        <option value="picked">Picked</option>
        <option value="started">Started</option>
        <option value="completed">Completed</option>
      </select>
      <label for="vehicle">Filter by vehicle:</label>
      <select id="vehicle">
        <option value="">All</option>
        <option value="car">Car</option>
        <option value="motorcycle">Motorcycle</option>
        <option value="scooter">Scooter</option>
        <option value="bicycle">Bicycle</option>
      </select>
      <label for="search" class="form-label">Search:</label>
      <input type="text" id="search" class="form-control" placeholder="Username, phone number, request ID...">
      <label for="from-date" class="form-label">From:</label>
      <input type="date" id="from-date" class="form-control">
      <label for="to-date" class="form-label">To:</label>
      <input type="date" id="to-date" class="form-control">
      <button type="submit" class="btn btn-primary mt-3">Apply Filters</button>

    </div>

    <!--
    <div class="modal-footer">
      <button type="button" class="btn btn-info" (click)="updateService(vehicle.value)">Save Updates</button>
      <button type="button" class="btn btn-danger" (click)="modal.close('Close click')">Delete Service</button>
    </div> -->
  </div>

</ng-template>




<div class="container-fluid mt--5">
  <!-- Table -->
  <div class="row">
    <div class="col">
      <div class="card shadow">
        <div class="card-header border-0 row mr-0 ml-0">
          <select class="form-control col-sm-1" name="search_type" id="search_type">
            <option value="_id" selected>Ride Id</option>
            <option value="user.name">User</option>
            <option value="pickup">Pickup</option>
            <option value="dropoff">Dropoff</option>
            <option value="vehicle.name">Vehicle</option>

          </select>
          <select class="form-control col-sm-1" name="payment_mode" id="payment_mode">
            <option value="" selected>All</option>
            <option value=0>Cash</option>
            <option value=1>Card</option>
          </select>
          <select class="form-control col-sm-1" name="status" id="status">
            <option value=0 selected>Pending</option>
            <option value=2>Accepted</option>
            <option value=3>Arrived</option>
            <option value=4> Picked</option>
            <option value=5> Started</option>
          </select>
          <input type="search" name="search_value" id="search_value" class="form-control col-sm-2" placeholder="Search"
            #search>
          <!-- <label for="from">From</label>1 -->
          <input class="col-sm-1 form-control" type="date" name="from_date" id="from_date">
          <!-- <label for="to">TO</label> -->
          <input class="col-sm-1 form-control" type="date" name="to_date" id="to_date">
          <!-- </div> -->
          <div class="btn-group col-sm-1">
            <button class="btn" type="submit" (click)="onSearch(search.value)">
              <i class="search-icon fas fa-search"></i>
            </button>
            <button class="btn refresh" (click)="showRides(1);search.value = ''">⟳</button>
          </div>

          <!-- </div> -->
<!--
          <div class="col-sm-4">

            <div class="form-control-search d-flex  align-items-center">
              <input type="search" class="form-control" placeholder="Search" #search>
              <div class="btn-group">
                <button class="btn" type="submit" (click)="onSearch(search.value)">
                  <i class="search-icon fas fa-search"></i>
                </button>
                <button class="btn refresh" (click)="showRides(1);search.value = ''">⟳</button>
              </div>
            </div>

          </div> -->




          <!-- <div class="col-sm-8 text-right">

            <button class="btn btn-outline-primary " (click)="openModel(content)"> + Add </button>
          </div> -->
        </div>
      <div class="table-responsive">
        <table class="table text-center">
          <thead>
            <tr>

              <th>Request ID</th>
              <th>User ID</th>
              <th>Driver ID</th>
              <th>Service Type</th>
              <th>Status</th>
              <th>Payment</th>
              <th>create time</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <!-- Use a loop to display all the requests with their details -->
            <!-- <tr *ngFor="let ride of ridesArray" (click)="openModel(content2)"> -->
            <tr *ngFor="let ride of ridesArray">
              <ng-template #content2 let-modal>
                <div class="bg-aliceblue modal-div ">

                  <div class="modal-header">
                    <h4>Service Type</h4>
                    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')"><span
                        aria-hidden="true">&times;</span></button>
                  </div>

                  <div class="modal-body ">

                    <div>User Name : {{ride.user.name }}</div>
                    <div>Pick Up : {{ride.picked}}</div>
                    <div>dropp off : {{ride.dropoff}}</div>
                    <div>No. Stops : {{ride.stop.length}}</div>
                    <div>Vehicle: {{ride.vehicle.name}}</div>
                    <div>Status : {{ride.status}}</div>
                    <div>Creat Time : {{ride.createdAt | utcDate}}</div>
                    <div>Assign Type : {{ride.assignType || '--'}}</div>
                    <div>Distence : {{ride.distance}}</div>
                  </div>

                </div>

              </ng-template>

              <td>{{ride._id || "--"}}</td>
              <td>{{ride.user.name || "--"}}</td>
              <td>{{ride.driver || "--"}}</td>
              <td> {{ride.vehicle.name || "--"}} </td>
              <td><span
                  [ngClass]="{'badge badge-pill badge-success': ride.status === 'accepted', 'badge badge-pill badge-warning': ride.status === 'processing', 'badge badge-pill badge-primary': ride.status === 'assigning', 'badge badge-pill badge-dark': ride.status === 0}"
                  id="s{{ride._id}}">{{ride.status | rideStatus }}</span></td>
              <td>{{ride.payment || "--"}}</td>
              <td>{{ride.createdAt || "--" | utcDate}}</td>
              <td>

                <!-- If a driver is not assigned, show a button to assign one -->
                <button class="btn btn		btn-primary" id="b{{ride._id}}" *ngIf="(ride.status ==0) && (!ride.assignType) "
                  (click)="openModel(content3)">Assign</button>
                <button class="btn btn		btn-primary" id="b{{ride._id}}"
                  *ngIf="(ride.status ==0) && (ride.assignType ==4)" (click)="openModel(content3)">Reassign</button>

                <ng-template #content3 let-modal>
                  <div class="bg-aliceblue modal-div ">

                    <div class="modal-header">
                      <h4>Service Type</h4>
                      <button type="button" class="close" aria-label="Close"
                        (click)="modal.dismiss('Cross click')"><span aria-hidden="true">&times;</span></button>
                    </div>

                    <div class="modal-body ">
                      <p><strong>Trip Details:</strong></p>

                      <div>Pick Up : {{ride.pickup}}</div>
                      <div>Drop Off : {{ride.dropoff}}</div>
                      <div>Vehicle : {{ride.vehicle}}</div>

                      <p><strong>Booking Time:</strong> {{ride.bookingtime}}</p>
                      <p><strong>Schedule Time:</strong> [insert schedule time here]</p>
                      <p><strong>Available Drivers:</strong></p>
                      <table class="table table-striped">
                        <thead>
                          <tr>
                            <th class="text-wrap">Driver ID</th>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Email</th>
                          </tr>
                        </thead>
                        <tbody>
                          <!-- <input type="radio" name="driver" value="{{driver._id}}" > -->

                          <tr *ngFor="let driver of OnlineDrivers" (click)="onRowClick(driver)"
                            [class.table-primary]="driver === selectedDriver">
                            <td>{{driver._id}}</td>
                            <td>{{driver.name}}</td>
                            <td>{{driver.mobile}}</td>
                            <td>{{driver.email}}</td>

                          </tr>
                        </tbody>
                      </table>

                      <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="assign-selected-driver"
                          (click)="onSelectAssign(ride,selectedDriver);modal.close('Close click')">Assign Selected
                          Driver</button>
                        <button type="button" class="btn btn-secondary" id="assign-nearest-driver"
                          (click)="onAutoAssign(ride);modal.close('Close click')">Assign Nearest
                          Driver</button>
                      </div>

                    </div>

                  </div>

                </ng-template>

                <!--
                  <div class="modal" id="{{ride._id}}">
                    <div class="modal-dialog custom-modal-dialog" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title">Assign Driver</h5>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                            (click)="closeAssignDialog(ride._id)">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">

                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-primary" id="assign-selected-driver"
                            (click)="onSelectAssign(ride,selectedDriver);closeAssignDialog(ride._id)">Assign Selected
                            Driver</button>
                          <button type="button" class="btn btn-secondary" id="assign-nearest-driver"
                            (click)="onAutoAssign(ride);closeAssignDialog(ride._id)">Assign Nearest
                            Driver</button>
                        </div>
                      </div>
                    </div>
                  </div> -->
              </td>

              <td>
                <!-- If the request is not accepted, show a button to cancel it -->
                <button class="btn btn-danger" *ngIf="ride.status !=='cancelled'"
                  (click)="onCancel(ride._id)">Cancel</button>
              </td>

            </tr>

          </tbody>
        </table>

      </div>
      <div class="card-footer py-4">
        <nav aria-label="...">
          <ul class="pagination justify-content-end mb-0">

            <li class="page-item disabled" *ngIf="currentPage!==1" (click)="onPrevious()">
              <a class="page-link">
                <i class="fas fa-angle-left"></i>
                <span class="sr-only">Previous</span>
              </a>
            </li>
            <li class="page-item" [ngClass]="{'active' : currentPage == i+1}"
              [hidden]="currentPage <i || currentPage-1 > i+1" *ngFor="let item of NoOfPages; let i = index"> <a
                class="page-link" (click)="onPage(i+1)">{{i+1}}</a>
            </li>

            <li class="page-item" [ngClass]="{'vh':currentPage==NoOfPages?.length }" (click)="onNext()">
              <a class="page-link">
                <i class="fas fa-angle-right"></i>
                <span class="sr-only">Next</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>

<!-- Dark table -->

</div>
